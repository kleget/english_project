# English Project

Проект для изучения английского языка через анализ книг. Система обрабатывает PDF-книги, извлекает слова, лемматизирует их, очищает от дубликатов и сохраняет в базы данных SQLite по категориям (математика, физика, биология, программирование и т.д.).

## Описание проекта

Проект предназначен для:
- Автоматической обработки PDF-книг и извлечения слов
- Лемматизации текста (русский и английский языки)
- Очистки от дубликатов и похожих слов с помощью алгоритма DSU и расстояния Левенштейна
- Сохранения результатов в базы данных SQLite с группировкой по категориям
- Анализа пересечений и объединений слов из разных книг

## Структура проекта

```
english_project/
├── book/                    # Папка с книгами
│   ├── pdf/                # Исходные PDF файлы
│   │   ├── math/           # Математические книги
│   │   ├── physics/        # Физические книги
│   │   ├── biology/        # Биологические книги
│   │   ├── code/           # Книги по программированию
│   │   └── ...
│   └── txt/                # Конвертированные TXT файлы (создаются автоматически)
│       ├── math/
│       ├── physics/
│       └── ...
├── database/               # Базы данных SQLite (создаются автоматически)
│   ├── math.db
│   ├── physics.db
│   ├── biology.db
│   └── ...
├── other/                  # Дополнительные файлы
│   ├── back_up_DB/        # Резервные копии БД
│   └── fasttext-*.whl     # FastText для Windows
├── config.py              # Конфигурация проекта
├── main.py                # Главный файл проекта
├── file_processing.py     # Обработка файлов (PDF→TXT, переименование)
├── text_analysis.py       # Анализ и очистка текста
├── lemmatize.py           # Лемматизация текста
├── detect_lang.py         # Определение языка текста
├── database_operations.py # Операции с базой данных
├── create_non_science_db.py # Создание таблиц пересечения и объединения
└── tasks.py               # Список задач (TODO)
```

## Требования

- **Python 3.11** — другие версии могут работать нестабильно или вовсе не запуститься.
- **NumPy 1.26.x** — fastText (используется для определения языка) несовместим с NumPy 2.x. Рекомендуемая версия: `numpy==1.26.4`.
- **Файл `lid.176.bin`** (модель fastText) должен лежать в корне проекта рядом с `main.py`, иначе определение языка не сработает.

Проверить версию Python:
```bash
python --version
# или
python3 --version
```

## Установка зависимостей

### Python пакеты

```bash
pip install pdfminer
pip install pdfminer.six
pip install spacy
pip install pymorphy3
pip install python-Levenshtein
pip install termcolor
pip install pdfreader
pip install colorama
```

### FastText (для определения языка)

**Windows:**
1. Скачайте wheel файл: https://github.com/facebookresearch/fastText/issues/1277#issuecomment-1955988614
2. Установите: `pip install other/fasttext-0.9.2-cp311-cp311-win_amd64.whl`

**Linux:**
```bash
pip install fasttext
```

### Spacy модель для английского языка

```bash
python -m spacy download en_core_web_sm
```

### Poppler-utils (для конвертации PDF в TXT)

**Windows:**
1. Скачайте последнюю версию: https://github.com/oschwartz10612/poppler-windows/releases/
2. Распакуйте в статическое место
3. Добавьте `\poppler\Library\bin` в переменную окружения PATH

**Linux:**
```bash
sudo apt-get install poppler-utils
```

### Модель FastText для определения языка

```bash
wget https://dl.fbaipublicfiles.com/fasttext/supervised-models/lid.176.bin
```

Поместите файл `lid.176.bin` в корневую директорию проекта.

## Настройка

1. Создайте пустую папку `database/` в корне проекта
2. Поместите книги в папку `book/` со следующей структурой:
   ```
   book/
   ├── pdf/
   │   ├── math/
   │   ├── physics/
   │   └── ...
   └── txt/  (создается автоматически)
   ```
3. В файле `config.py` укажите правильный путь до папки `book/`:
   ```python
   rootdir = 'E:/Code/english_project/book'  # Windows
   # rootdir = '/home/kleget/Code/english_project/book'  # Linux
   ```

## Поток выполнения проекта

1. **Запуск `main.py`**
   - Инициализация и начало отсчета времени выполнения

2. **Очистка имен файлов** (`rename_files_in_directory`)
   - Удаление мусорных символов из названий PDF файлов
   - Замена точек, пробелов и специальных символов на подчеркивания

3. **Конвертация PDF → TXT** (`pdf_to_txt`)
   - Рекурсивный обход всех PDF файлов в `book/pdf/`
   - Конвертация каждого PDF в TXT с помощью `pdftotext`
   - Сохранение TXT файлов в соответствующие папки `book/txt/`

4. **Рекурсивная обработка файлов** (`reqursion`)
   Для каждого TXT файла:
   - **Извлечение слов** (`analysand_func_dict`)
     - Чтение TXT файла
     - Лемматизация текста (параллельная обработка)
     - Очистка от аномалий (числа, слишком длинные/короткие слова)
     - Подсчет частоты каждого слова
   
   - **Фильтрация обычных слов**
     - Исключение слов, уже присутствующих в базе обычных слов категории
     - Остаются только специализированные слова
   
   - **Сортировка по частоте**
     - Сортировка словаря по убыванию частоты встречаемости
   
   - **Очистка от дубликатов** (`algo_cleaner` → `algo_DSU`)
     - Группировка слов по длине
     - Поиск похожих слов с помощью алгоритма DSU (Disjoint Set Union)
     - Использование расстояния Левенштейна для определения похожести
     - Объединение похожих слов в группы
     - Суммирование частот объединенных слов
     - Сохранение информации об удаленных словах
   
   - **Сохранение в БД**
     - Запись очищенных слов в таблицу книги
     - Запись удаленных слов в таблицу `from_all_files`
   
   - **Создание итоговых таблиц** (для последнего файла категории)
     - `word_intersection` - слова, встречающиеся во всех книгах категории
     - `global_union` - все слова из всех книг категории с суммированием частот

5. **Завершение**
   - Вывод статистики обработки
   - Вывод времени выполнения

## Зависимости

### Основные библиотеки

| Библиотека | Назначение |
|------------|------------|
| `pdfreader` | Чтение PDF файлов |
| `pymorphy3` | Лемматизация русского языка |
| `spacy` + `en_core_web_sm` | Лемматизация английского языка |
| `fasttext` | Определение языка текста |
| `python-Levenshtein` | Вычисление расстояния Левенштейна для поиска похожих слов |
| `sqlite3` | Работа с базами данных SQLite |
| `colorama` | Цветной вывод в терминал |
| `termcolor` | Цветной вывод в терминал |

### Внешние утилиты

- **poppler-utils** (pdftotext) - конвертация PDF в TXT
- **FastText модель** (lid.176.bin) - модель для определения языка

## Структура базы данных

Для каждой категории (math, physics, biology, code и т.д.) создается отдельная база данных SQLite в папке `database/`.

### Таблицы по книгам

Каждая книга имеет свою таблицу с именем, очищенным от специальных символов.

**Схема:**
```sql
CREATE TABLE {имя_книги} (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    word TEXT NOT NULL,
    count INTEGER NOT NULL
);
```

**Пример:** Таблица `math_in_machine_learning` в базе `code.db`

### Таблица удаленных слов

**Таблица:** `from_all_files` (в базе `delete.db`)

**Схема:**
```sql
CREATE TABLE from_all_files (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    deleted_word TEXT NOT NULL,
    count INTEGER NOT NULL,
    merged_to TEXT NOT NULL
);
```

**Назначение:** Хранит информацию о словах, которые были объединены с другими похожими словами. Поле `merged_to` указывает, с каким словом было объединено удаленное слово.

### Таблица пересечения

**Таблица:** `word_intersection` (в каждой категории БД)

**Схема:**
```sql
CREATE TABLE word_intersection (
    word TEXT,
    total_count INTEGER
);
```

**Назначение:** Содержит слова, которые встречаются **во всех книгах** данной категории. Частоты суммируются из всех книг.

### Таблица объединения

**Таблица:** `global_union` (в каждой категории БД)

**Схема:**
```sql
CREATE TABLE global_union (
    word TEXT,
    total_count INTEGER
);
```

**Назначение:** Содержит **все уникальные слова** из всех книг категории с суммированием частот.

### Пример структуры базы данных

```
database/
├── math.db
│   ├── math_in_machine_learning (таблица книги)
│   ├── Лекции_по_дискретной_математике (таблица книги)
│   ├── word_intersection (пересечение всех книг)
│   └── global_union (объединение всех книг)
├── physics.db
│   ├── Савуков_Статистическая_физика_2006
│   ├── Тесла_Переменный_ток_2015
│   ├── word_intersection
│   └── global_union
├── biology.db
│   └── ...
├── code.db
│   └── ...
└── delete.db
    └── from_all_files (все удаленные слова из всех категорий)
```

## Использование

Запустите главный файл:

```bash
python main.py
```

Проект автоматически:
1. Обработает все PDF файлы
2. Конвертирует их в TXT
3. Извлечет и обработает слова
4. Сохранит результаты в базы данных

## Конфигурация

Основные параметры настройки находятся в `config.py`:

- `rootdir` - путь к папке с книгами
- `LEN_LEVENSHTEIN` - максимальное расстояние Левенштейна для объединения похожих слов (по умолчанию: 3)
- `MIN_WORD_LENGTH` - минимальная длина слова для обработки (по умолчанию: 4)
- `chars` - символы-разделители для обработки текста

## Примечания

- Проект работает с книгами на русском и английском языках
- Лемматизация выполняется параллельно для ускорения обработки
- Алгоритм DSU оптимизирован с использованием кэширования и группировки по префиксам
- Для больших объемов данных обработка может занять значительное время